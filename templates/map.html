<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI-Driven Cyclone Prediction</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f1f1f1;
    }
    .container {
      display: flex;
      flex-direction: row;
      padding: 30px;
      align-items: flex-start;
      background: #fff;
      width: 100%;
      box-sizing: border-box;
    }
    .left-panel {
      flex: 1;
      padding-right: 20px;
    }
    .right-panel {
      flex: 2;
      position: relative;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    h1 span {
      color: red;
    }
    h2 {
      font-weight: 400;
      font-size: 18px;
      margin-top: 0;
      margin-bottom: 20px;
    }
    button, input {
      font-size: 16px;
      border: none;
      border-radius: 12px;
      padding: 12px 20px;
      margin-bottom: 16px;
    }
    .loc-btn {
      background-color: #c62828;
      color: white;
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
    }
    .search-btn {
      background-color: #eef0e5;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
    }
    input[type="text"] {
      width: 100%;
      margin-top: 8px;
      background-color: #f3f3f3;
      padding: 10px;
    }
    .coords-box {
      background-color: #99999933;
      padding: 16px;
      border-radius: 12px;
      font-weight: bold;
    }
    #map {
      height: 400px;
      border-radius: 10px;
    }
    .next-btn {
      position: absolute;
      top: 0;
      right: 0;
      background-color: #c62828;
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="left-panel">
    <h1><span>AI-DRIVEN</span> CYCLONE PREDICTION</h1>
    <h2>CHOOSE PREDICTION LOCATION</h2>

    <button class="loc-btn" onclick="getCurrentLocation()">üìç Your Location</button>

    <button class="search-btn">
      üîç <input type="text" id="address" placeholder="Search Location" onkeydown="if(event.key==='Enter') search()">
    </button>

    <div class="coords-box">
      <div>Lat. <input id="lat" readonly></div>
      <div>Long. <input id="lon" readonly></div>
    </div>
  </div>

  <div class="right-panel">
    <button class="next-btn">NEXT</button>
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([10.768571, 106.779494], 10);
  let marker;

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  function setMarker(lat, lon, label = "Selected Location") {
    if (marker) map.removeLayer(marker);
    marker = L.marker([lat, lon]).addTo(map).bindPopup(label).openPopup();
    map.setView([lat, lon], 10);
    document.getElementById("lat").value = lat.toFixed(6);
    document.getElementById("lon").value = lon.toFixed(6);
  }

  function getCurrentLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (pos) {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        setMarker(lat, lon, "Your Location");
      }, function () {
        alert("Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ hi·ªán t·∫°i.");
      });
    }
  }

  function search() {
    const address = document.getElementById("address").value;
    if (!address) return;

    fetch("/get_coords", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({address})
    })
    .then(res => res.json())
    .then(data => {
      if (data.lat && data.lon) {
        setMarker(parseFloat(data.lat), parseFloat(data.lon), address);
      } else {
        alert("Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ.");
      }
    });
  }
</script>

</body>
</html>
